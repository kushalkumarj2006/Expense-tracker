<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Balance Tracker</title>

<meta name="theme-color" content="#ffffff" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-mobile-web-app-title" content="Balance Tracker" />

<link rel="manifest" href="data:application/json,{
  &quot;name&quot;:&quot;Balance Tracker&quot;,
  &quot;short_name&quot;:&quot;Balance&quot;,
  &quot;start_url&quot;:&quot;.&quot;,
  &quot;display&quot;:&quot;standalone&quot;,
  &quot;background_color&quot;:&quot;#f8fafc&quot;,
  &quot;theme_color&quot;:&quot;#ffffff&quot;
}">

<style>
:root{
  --bg:#f8fafc;
  --card:#ffffff;
  --border:#e5e7eb;
  --text:#0f172a;
  --muted:#64748b;
  --primary:#2563eb;
  --green:#16a34a;
  --yellow:#ca8a04;
  --red:#dc2626;
}

*{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto}

body{
  margin:0;
  background:linear-gradient(#f8fafc,#eef2f7);
  color:var(--text);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.app{width:100%;max-width:420px;padding:20px}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:22px;
  padding:24px;
  box-shadow:0 12px 30px rgba(0,0,0,.08);
}

h1{margin:0 0 18px;font-size:1.55rem;font-weight:700}

.balance{
  font-size:3rem;
  font-weight:900;
  transition:color .3s ease;
}

.sub{
  margin-top:6px;
  margin-bottom:14px;
  color:var(--muted);
  font-size:.85rem;
}

.section{margin-bottom:16px}

label{
  display:block;
  font-size:.75rem;
  font-weight:600;
  text-transform:uppercase;
  color:var(--muted);
  margin-bottom:6px;
}

input,select{
  width:100%;
  background:#fff;
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px 16px;
  font-size:1.05rem;
  color:var(--text);
}

input:focus,select:focus{
  border-color:var(--primary);
  outline:none;
}

button{
  margin-top:8px;
  width:100%;
  padding:16px;
  border:none;
  border-radius:18px;
  font-size:1.4rem;
  font-weight:900;
  background:linear-gradient(180deg,#3b82f6,#2563eb);
  color:#fff;
}

button:active{transform:scale(.985)}

.hidden{display:none}

/* Widget mode */
.widget h1,
.widget .section,
.widget button,
.widget .history,
.widget .footer{
  display:none;
}

.widget .card{
  padding:18px;
  box-shadow:none;
}

.widget .balance{font-size:2.6rem}

.widget-cta{
  margin-top:10px;
  padding:10px 14px;
  border-radius:12px;
  background:var(--primary);
  color:#fff;
  font-weight:700;
  font-size:.9rem;
  display:inline-block;
}

html[data-widget="small"] .widget-cta,
html[data-widget="small"] .sub{
  display:none;
}

.history{
  margin-top:20px;
  border-top:1px solid var(--border);
}

.entry{
  padding:14px 0;
  border-bottom:1px solid var(--border);
}

.entry strong{font-size:.95rem}
.entry .meta{font-size:.75rem;color:var(--muted)}

.footer{
  text-align:center;
  margin-top:14px;
  font-size:.7rem;
  color:var(--muted);
}
</style>
</head>

<body>
<div class="app">
<div class="card">

<h1>Balance Tracker</h1>

<div id="balance" class="balance">₹0</div>
<div id="expiryInfo" class="sub"></div>
<div id="quickAdd" class="widget-cta hidden">+ Add expense</div>

<div class="section">
<label>Description</label>
<select id="descSelect">
  <option value="">Select category</option>
  <option>Snack / Juice</option>
  <option>Food</option>
  <option>Travel</option>
  <option>Office</option>
  <option>Stationaries</option>
  <option value="Other">Other</option>
</select>
<input id="descOther" class="hidden" placeholder="Enter description" />
</div>

<div class="section">
<label>Amount</label>
<input id="expr" placeholder="+200   -50   4500-32" inputmode="decimal" />
</div>

<div class="section">
<label>Expiry Date</label>
<input id="expiry" type="date" />
</div>

<button id="equals">=</button>

<div class="history" id="history"></div>

<div class="footer">Offline · Private · Device-only</div>

</div>
</div>

<script>
const todayISO=()=>new Date().toISOString().split("T")[0];
const daysBetween=(a,b)=>Math.floor((a-b)/86400000);

function evalMath(expr){
  if(!/^[0-9+\-*/().\s]+$/.test(expr)) throw "bad";
  return Function("return ("+expr+")")();
}

const KEY="balance_tracker_v1";
function load(){
  try{
    return JSON.parse(localStorage.getItem(KEY)) ||
      {version:1,balance:0,expiry:todayISO(),history:[]};
  }catch{
    return {version:1,balance:0,expiry:todayISO(),history:[]};
  }
}
function save(s){localStorage.setItem(KEY,JSON.stringify(s));}

const isStandalone=
  window.matchMedia('(display-mode: standalone)').matches ||
  window.navigator.standalone===true;

let state=load();

const balanceEl=document.getElementById("balance");
const expiryEl=document.getElementById("expiry");
const expiryInfo=document.getElementById("expiryInfo");
const histEl=document.getElementById("history");
const exprEl=document.getElementById("expr");
const descSelect=document.getElementById("descSelect");
const descOther=document.getElementById("descOther");
const quickAdd=document.getElementById("quickAdd");

expiryEl.min=todayISO();
expiryEl.value=state.expiry;

descSelect.onchange=()=>{
  descOther.classList.toggle("hidden",descSelect.value!=="Other");
};

if(isStandalone){
  document.documentElement.classList.add("widget");
  quickAdd.classList.remove("hidden");

  const size=window.innerHeight<520?"small":"medium";
  document.documentElement.dataset.widget=size;

  quickAdd.onclick=e=>{
    e.stopPropagation();
    location.hash="#add";
    location.reload();
  };
}

if(location.hash==="#add"){
  document.documentElement.classList.remove("widget");
  setTimeout(()=>exprEl.focus(),300);
}

function render(){
  const today=new Date(todayISO());
  const expiry=new Date(state.expiry);
  const daysLeft=Math.max(0,daysBetween(expiry,today)+1);
  const threshold=(daysLeft*250)/7;
  const dailySafe=daysLeft?Math.floor(state.balance/daysLeft):0;

  if(state.balance>=threshold) balanceEl.style.color="var(--green)";
  else if(state.balance>=threshold-50 && state.balance<=threshold+50)
    balanceEl.style.color="var(--yellow)";
  else balanceEl.style.color="var(--red)";

  balanceEl.textContent="₹"+state.balance.toLocaleString();

  expiryInfo.textContent=
    daysLeft>0
      ? `${daysLeft} days left · Daily safe ₹${dailySafe}`
      : "Expired";

  if(!isStandalone){
    histEl.innerHTML=state.history.slice(-5).reverse().map(h=>`
      <div class="entry">
        <strong>${h.desc}</strong>
        <div class="meta">${h.expr} → ₹${h.balance}</div>
      </div>
    `).join("");
  }
}
render();

document.getElementById("equals").onclick=()=>{
  let expr=exprEl.value.trim();
  if(!expr)return;
  if(!/^[+\-*/]/.test(expr)) expr="+"+expr;

  const desc=
    descSelect.value==="Other"
      ? descOther.value.trim()
      : descSelect.value;

  if(!desc){alert("Description required");return;}

  try{
    const delta=evalMath(expr);
    state.balance=Math.round((state.balance+delta)*100)/100;

    state.history.push({
      ts:Date.now(),
      expr,desc,delta,balance:state.balance
    });

    save(state);
    exprEl.value="";
    descSelect.value="";
    descOther.value="";
    descOther.classList.add("hidden");
    render();
  }catch{
    alert("Invalid arithmetic input");
  }
};

expiryEl.onchange=()=>{
  if(expiryEl.value<todayISO()) expiryEl.value=todayISO();
  state.expiry=expiryEl.value;
  save(state);
  render();
};
</script>
</body>
</html>